<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>200,000 RICE at your grasp</title>
		<link rel="stylesheet" type="text/css" href="../style.css" />
		<link rel="stylesheet" type="text/css" href="styleEn.css" />
	</head>
	<body>
		<div class="wrapper">
			<div class="top">
				<div class="topContent">
					<img
						class="imgSlogan imgSloganEn"
						
						src="../images/logoEn.png"
					/>
					<span class="textSloganEn">Luckydraw through Red Packet</span>
					<img
						class="imgSlogan"
						style="margin-top: default;"
						src="../images/riceEn.png"
					/>
					<div class="triangle"></div>
					<div class="priceWrapper priceWrapperEn">
						<div>
							<div>
								<span>Current Winning Odds</span>
								<span>Winning RICE/ Winning Pool</span>
							</div>
							<div>
								<span id="rate">**%</span>
								<span
									><span id="currentPrice">5,000</span>
									<span style="font-weight: 300;">/</span>
									50,000</span
								>
							</div>
						</div>
						<div>
							<!-- <a
								class="rules"
								href="https://medium.com/loopring-protocol/trade-dpr-on-loopring-layer-2-million-dpr-at-your-grasp-9f870fd9ca2b"
								>Lottery Rules ></a
							> -->
						</div>
					</div>
				</div>
			</div>
			<div class="bottom">
				<div id="lotteryTitle">路 Eligible addresses for lottery 路</div>
				<div class="updateTime">
					Data update: update after 0:00 am (UTC) the next day
				</div>
				<div class="userListWrapper">
					<input
						id="inputSearch"
						class="inputSearch"
						type="text"
						placeholder="Input your account ID or address"
					/>
					<div class="listContentWrapper">
						<div class="listTitleLine">
							<span>Account ID</span>
							<span>Address</span>
						</div>
						<div id="userList" class="userList"></div>
					</div>
				</div>
				<!-- <div class="btnLine">
					<span id="leftTimeWrapper"
						>Time Ends:<span id="leftTime"></span
					></span>
					<button id="btnAttend" class="btnAttend">
						<a
							class="rules"
							style="color: white; font-size: 14px;"
							href="https://exchange.loopring.io/"
							>Participate</a
						>
					</button>
				</div> -->
			</div>
		</div>
		<script type="text/javascript" src="../jquery.min.js"></script>
		<script type="text/javascript" src="../jquery.csv.min.js"></script>
		<script>
			$(document).ready(function() {
				let jsonData = []
				function getData(){
					$.ajax({
						// url: 'http://uat2.loopring.io/api/v3/user/daoSquareAccounts',
						url: 'http://api3.loopring.io/api/v3/user/daoSquareAccounts?startTime=0&endTime=0',
						success: function(res) {
							if (res && res.data && res.data.length) {
								jsonData = res.data
								setUserList(res.data)
								$('#rate').html(`${res.data.length <= 10 ? 100 : parseInt(10 / res.data.length * 100)}%`)
							}
						}
					})
					return true
				}
				getData() && setInterval(getData, 10 * 60 * 1000)

				$('#inputSearch').on('input', (e) => {
					const keyword = e.target.value
					const formattedKeyword = keyword.toLowerCase()
					const isInvolved = jsonData.find(
						(o) =>
							String(o.accountId) === formattedKeyword ||
							o.address === formattedKeyword
					)
					if (!!jsonData.length && isInvolved) {
						const head = isInvolved.address.substring(0, 8)
						const tail = isInvolved.address.substring(
							isInvolved.address.length - 6,
							isInvolved.address.length
						)
						const address = `${head}...${tail}`
						$('#userList').html(
							`
                            <div class="singleUser">
                                <span class="userId">${isInvolved.accountId}</span>
                                <span class="userAddress">${address}</span>
                            </div>
                        `
						)
						return
					}
					if (!keyword) {
						setUserList(jsonData)
						return
					}
					$('#userList').html('')
				})
				function setUserList(data) {
					data.forEach(o => {
						const head = o.address.substring(0, 8)
						const tail = o.address.substring(
							o.address.length - 6,
							o.address.length
						)
						const address = `${head}...${tail}`
						$('#userList').append(
							`
                            <div class="singleUser" style="margin-bottom: 10px;">
                                <span class="userId">${o.accountId}</span>
                                <span class="userAddress">${address}</span>
                            </div>
                        `
						)
					})
					// $('#rate').html(`${parseInt((30 / data.length) * 100)}%`)
				}
			})
			// $(document).ready(function() {
			// 	// get countdown
			// 	;(function getLefttime() {
			// 		const targetTime = new Date('2021/04/22 08:00:00')
			// 		const currentTime = new Date()
			// 		const diff = targetTime - currentTime
			// 		if (diff < 0) {
			// 			$('#lotteryTitle').html('路 Winner List 路')
			// 			$('#leftTimeWrapper').html(
			// 				`<span class="timeNumber" style="color: black">Activity ended</span>`
			// 			)
			// 			$('#btnAttend').html(
			// 				`<a
			// 					class="rules"
            //                     style="color: white; font-size: 14px;"
            //                     href="https://medium.com/loopring-protocol/loopring-dpr-lottery-mechanism-d1eabf678a94"
            //                     >Lottery Mechanism
            //                 </a>`
			// 			)
			// 			// $('#btnAttend').css({
			// 			// 	'background-color': '#bec8c8',
			// 			// })
			// 		} else {
			// 			setInterval(() => {
			// 				// const targetTime = new Date('2021/04/22 08:00:00')
			// 				// const currentTime = new Date()
			// 				// const diff = targetTime - currentTime

			// 				const leftDays = Math.floor(
			// 					diff / (24 * 3600 * 1000)
			// 				)
			// 				const msHours = diff % (24 * 3600 * 1000)
			// 				const leftHours = Math.floor(
			// 					msHours / (3600 * 1000)
			// 				)
			// 				const msMinutes = msHours % (3600 * 1000)
			// 				const leftMinutes = Math.floor(
			// 					msMinutes / (60 * 1000)
			// 				)
			// 				const msSeconds = msMinutes % (60 * 1000)
			// 				const leftSeconds = Math.floor(msSeconds / 1000)
			// 				$('#leftTime').html(
			// 					`<span class="timeNumber">${leftDays}</span>D<span class="timeNumber">${leftHours}</span>H<span class="timeNumber">${leftMinutes}</span>M<span class="timeNumber">${leftSeconds}</span>S`
			// 				)
			// 			}, 1000)
			// 		}

			// 		// get DPR price
			// 		function getDprPrice() {
			// 			$.ajax({
			// 				url:
			// 					'https://api3.loopring.io/api/wallet/v3/latestTokenPrices?tokens=0xf3ae5d769e153ef72b4e3591ac004e89f48107a1&currency=USDT',
			// 				type: 'get',
			// 				success: function(data) {
			// 					if (!!data.data.length) {
			// 						const dprPrice = Number(
			// 							data.data[0].price
			// 						).toFixed(2)
			// 						$('#currentPrice').html(`$${dprPrice}`)
			// 					}
			// 				},
			// 			})
			// 			return true
			// 		}
			// 		getDprPrice() && setInterval(getDprPrice, 30 * 1000)
			// 	})()
			// 	// original csv data
			// 	let jsonData = []
			// 	$('#inputSearch').on('input', (e) => {
			// 		const keyword = e.target.value
			// 		const formattedKeyword = keyword.toLowerCase()
			// 		const isInvolved = jsonData.find(
			// 			(o) =>
			// 				o.id === formattedKeyword ||
			// 				o.address === formattedKeyword
			// 		)
			// 		if (!!jsonData.length && isInvolved) {
			// 			const head = isInvolved.address.substring(0, 8)
			// 			const tail = isInvolved.address.substring(
			// 				isInvolved.address.length - 6,
			// 				isInvolved.address.length
			// 			)
			// 			const address = `${head}...${tail}`
			// 			$('#userList').html(
			// 				`
            //                 <div class="singleUser">
            //                     <span class="userId">${isInvolved.id}</span>
            //                     <span class="userAddress">${address}</span>
            //                 </div>
            //             `
			// 			)
			// 			return
			// 		}
			// 		if (!keyword) {
			// 			setUserList(jsonData)
			// 			return
			// 		}
			// 		$('#userList').html('')
			// 	})
			// 	function setUserList(data) {
			// 		data.forEach((o, index) => {
			// 			const head = o.address.substring(0, 8)
			// 			const tail = o.address.substring(
			// 				o.address.length - 6,
			// 				o.address.length
			// 			)
			// 			const address = `${head}...${tail}`
			// 			$('#userList').append(
			// 				`
            //                 <div class="singleUser" style="margin-bottom: 10px">
            //                     <span class="userId">${o.id}</span>
            //                     <span class="userAddress">${address}</span>
            //                 </div>
            //             `
			// 			)
			// 		})
			// 		// $('#rate').html(`${parseInt((30 / data.length) * 100)}%`)
			// 	}
			// 	// const csvFile = '../DPR.csv'
			// 	const csvFile = '../winners.csv'
			// 	$.ajax({
			// 		url: csvFile,
			// 		dataType: 'text',
			// 		success: function(data) {
			// 			jsonData = $.csv.toArrays(data).map((o) => ({
			// 				id: o[0],
			// 				address: o[1],
			// 			}))
			// 			setUserList(jsonData)
			// 		},
			// 	})
			// })
		</script>
	</body>
</html>
